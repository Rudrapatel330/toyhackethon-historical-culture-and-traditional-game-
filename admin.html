<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bharatiya Culture - Admin Panel</title>
    <link href="https://fonts.googleapis.com/css2?family=Baloo+2:wght@400;600;700&family=Hind:wght@300;400;500&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #FF9933;
            --secondary: #128807;
            --accent: #FFD700;
            --light: #FFF9E6;
            --dark: #2E1A0F;
            --text: #333333;
            --level1: #FF6B6B;
            --level2: #4ECDC4;
            --level3: #FFD166;
            --level4: #06D6A0;
            --level5: #118AB2;
            --level6: #073B4C;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Hind', sans-serif;
            background: linear-gradient(135deg, #1a2a6c, #b21f1f, #fdbb2d);
            color: var(--text);
            line-height: 1.6;
            min-height: 100vh;
        }

        h1, h2, h3, h4 {
            font-family: 'Baloo 2', cursive;
            color: white;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }

        /* Navigation */
        .navbar {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            padding: 1rem 0;
            position: sticky;
            top: 0;
            z-index: 1000;
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
        }

        .nav-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .nav-logo {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 1.5rem;
            font-weight: 700;
            color: white;
        }

        .logo-icon {
            font-size: 2rem;
        }

        .nav-menu {
            display: flex;
            gap: 2rem;
        }

        .nav-link {
            color: white;
            text-decoration: none;
            padding: 0.5rem 1rem;
            border-radius: 25px;
            transition: all 0.3s ease;
        }

        .nav-link:hover, .nav-link.active {
            background: var(--primary);
            color: white;
        }

        /* Admin Panel */
        .admin-page {
            padding: 2rem 0;
            min-height: calc(100vh - 200px);
        }

        .page-header {
            text-align: center;
            margin-bottom: 3rem;
        }

        .page-header h1 {
            font-size: 3rem;
            margin-bottom: 1rem;
        }

        .page-header p {
            font-size: 1.2rem;
            color: white;
        }

        .admin-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
            margin-bottom: 3rem;
        }

        .admin-card {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 25px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
            backdrop-filter: blur(10px);
            border: 2px solid rgba(255, 255, 255, 0.8);
        }

        .admin-card h2 {
            color: var(--dark);
            margin-bottom: 1.5rem;
            text-shadow: none;
            font-size: 1.8rem;
        }

        .admin-form {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        .form-group label {
            margin-bottom: 0.5rem;
            font-weight: 500;
            color: var(--dark);
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 10px;
            font-family: inherit;
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(255, 153, 51, 0.2);
        }

        .form-group textarea {
            resize: vertical;
            min-height: 100px;
        }

        .video-upload-area {
            border: 2px dashed #ccc;
            border-radius: 10px;
            padding: 2rem;
            text-align: center;
            margin-bottom: 1rem;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .video-upload-area:hover {
            border-color: var(--primary);
            background: rgba(255, 153, 51, 0.05);
        }

        .video-upload-area.dragover {
            border-color: var(--secondary);
            background: rgba(18, 136, 7, 0.05);
        }

        .upload-icon {
            font-size: 3rem;
            margin-bottom: 1rem;
            color: #666;
        }

        .video-preview {
            margin-top: 1rem;
            display: none;
        }

        .video-preview video {
            width: 100%;
            border-radius: 10px;
            max-height: 200px;
            object-fit: cover;
        }

        .submit-btn {
            background: var(--secondary);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 50px;
            font-family: 'Baloo 2', cursive;
            font-size: 1.2rem;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 1rem;
        }

        .submit-btn:hover {
            background: var(--primary);
            transform: translateY(-3px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.2);
        }

        /* Levels List */
        .levels-list {
            max-height: 400px;
            overflow-y: auto;
            margin-top: 1rem;
        }

        .level-item {
            background: var(--light);
            padding: 1rem;
            margin-bottom: 1rem;
            border-radius: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.3s ease;
        }

        .level-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .level-item-info h4 {
            color: var(--dark);
            margin-bottom: 0.5rem;
            text-shadow: none;
        }

        .level-item-info p {
            color: #666;
            font-size: 0.9rem;
        }

        .level-actions {
            display: flex;
            gap: 0.5rem;
        }

        .action-btn {
            padding: 8px 12px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.3s ease;
        }

        .edit-btn {
            background: var(--accent);
            color: var(--dark);
        }

        .delete-btn {
            background: #ff4444;
            color: white;
        }

        .action-btn:hover {
            transform: scale(1.05);
        }

        /* Video List */
        .videos-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 1rem;
            margin-top: 1rem;
        }

        .video-item {
            background: var(--light);
            padding: 1rem;
            border-radius: 10px;
            text-align: center;
            transition: all 0.3s ease;
        }

        .video-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .video-thumbnail {
            width: 100%;
            height: 120px;
            background: #ddd;
            border-radius: 5px;
            margin-bottom: 0.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            color: #666;
        }

        /* Footer */
        .footer {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            padding: 3rem 0 1rem;
            margin-top: 4rem;
            border-top: 1px solid rgba(255, 255, 255, 0.2);
        }

        .footer-content {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 2rem;
            margin-bottom: 2rem;
        }

        .footer-section h3 {
            margin-bottom: 1rem;
            color: white;
        }

        .footer-section a {
            display: block;
            color: white;
            text-decoration: none;
            margin-bottom: 0.5rem;
        }

        .footer-section a:hover {
            color: var(--accent);
        }

        .footer-bottom {
            text-align: center;
            padding-top: 2rem;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            color: white;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .nav-container {
                flex-direction: column;
                gap: 1rem;
            }
            
            .page-header h1 {
                font-size: 2.5rem;
            }
            
            .admin-container {
                grid-template-columns: 1fr;
            }
            
            .level-item {
                flex-direction: column;
                align-items: flex-start;
                gap: 1rem;
            }
            
            .level-actions {
                align-self: flex-end;
            }
        }

        /* Toast Notifications */
        .toast {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 20px;
            background: var(--secondary);
            color: white;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            transform: translateX(150%);
            transition: transform 0.3s ease;
            z-index: 1000;
        }

        .toast.show {
            transform: translateX(0);
        }

        .toast.error {
            background: #ff4444;
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar">
        <div class="nav-container">
            <div class="nav-logo">
                <div class="logo-icon">üß∏</div>
                <span class="logo-text">Bharatiya Heritage</span>
            </div>
            <div class="nav-menu">
                <a href="index.html" class="nav-link">Home</a>
                <a href="levels.html" class="nav-link">Levels</a>
                <a href="admin.html" class="nav-link active">Admin</a>
            </div>
        </div>
    </nav>

    <!-- Admin Panel -->
    <section class="admin-page">
        <div class="container">
            <div class="page-header">
                <h1>Admin Panel</h1>
                <p>Manage levels and upload videos for the cultural learning journey</p>
            </div>

            <div class="admin-container">
                <!-- Add Level Form -->
                <div class="admin-card">
                    <h2>Add New Level</h2>
                    <form class="admin-form" id="levelForm">
                        <div class="form-group">
                            <label for="levelNumber">Level Number</label>
                            <input type="number" id="levelNumber" min="1" max="12" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="levelTitle">Level Title</label>
                            <input type="text" id="levelTitle" placeholder="e.g., Festivals & Celebrations" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="levelDescription">Description</label>
                            <textarea id="levelDescription" placeholder="Describe what this level teaches..." required></textarea>
                        </div>
                        
                        <div class="form-group">
                            <label for="levelIcon">Icon</label>
                            <select id="levelIcon" required>
                                <option value="üéâ">üéâ Festivals</option>
                                <option value="üé®">üé® Arts</option>
                                <option value="üìñ">üìñ Mythology</option>
                                <option value="üé≤">üé≤ Games</option>
                                <option value="üõ†Ô∏è">üõ†Ô∏è Craftsmanship</option>
                                <option value="üåø">üåø Values</option>
                                <option value="üèõÔ∏è">üèõÔ∏è Heritage</option>
                                <option value="üçõ">üçõ Cuisine</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="levelStatus">Status</label>
                            <select id="levelStatus" required>
                                <option value="available">Available</option>
                                <option value="completed">Completed</option>
                                <option value="locked">Locked</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="culturalPoints">Cultural Points</label>
                            <input type="number" id="culturalPoints" min="0" value="100" required>
                        </div>
                        
                        <button type="submit" class="submit-btn">Add Level</button>
                    </form>
                </div>

                <!-- Upload Video Form -->
                <div class="admin-card">
                    <h2>Upload Video</h2>
                    <form class="admin-form" id="videoForm">
                        <div class="form-group">
                            <label for="videoLevel">Select Level</label>
                            <select id="videoLevel" required>
                                <option value="">Choose a level...</option>
                                <!-- Levels will be populated by JavaScript -->
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="videoTitle">Video Title</label>
                            <input type="text" id="videoTitle" placeholder="Enter video title" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="videoDescription">Video Description</label>
                            <textarea id="videoDescription" placeholder="Describe the video content..."></textarea>
                        </div>
                        
                        <div class="video-upload-area" id="videoUploadArea">
                            <div class="upload-icon">üìÅ</div>
                            <p>Click to upload or drag and drop</p>
                            <p style="font-size: 0.9rem; color: #666;">MP4, WebM, or OGG files (Max: 50MB)</p>
                            <input type="file" id="videoFile" accept="video/*" style="display: none;">
                        </div>
                        
                        <div class="video-preview" id="videoPreview">
                            <video controls>
                                Your browser does not support the video tag.
                            </video>
                        </div>
                        
                        <button type="submit" class="submit-btn">Upload Video</button>
                    </form>
                </div>
            </div>

            <!-- Levels List -->
            <div class="admin-card">
                <h2>Manage Levels</h2>
                <div class="levels-list" id="levelsList">
                    <!-- Levels will be populated by JavaScript -->
                </div>
            </div>

            <!-- Videos List -->
            <div class="admin-card">
                <h2>Uploaded Videos</h2>
                <div class="videos-list" id="videosList">
                    <!-- Videos will be populated by JavaScript -->
                </div>
            </div>
        </div>
    </section>

    <!-- Toast Notification -->
    <div class="toast" id="toast"></div>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <h3>Bharatiya Heritage</h3>
                    <p>Reviving India's cultural heritage through interactive play and learning.</p>
                </div>
                <div class="footer-section">
                    <h3>Quick Links</h3>
                    <a href="index.html">Home</a>
                    <a href="levels.html">Levels</a>
                    <a href="admin.html">Admin</a>
                </div>
                <div class="footer-section">
                    <h3>Contact</h3>
                    <p>Email: info@bharatiyaheritage.com</p>
                    <p>Phone: +91 98765 43210</p>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2023 Bharatiya Culture, Heritage & Tradition in Play. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <script>
        // API base URL
        const API_BASE = 'http://localhost:3000/api';

        // DOM Elements
        const levelForm = document.getElementById('levelForm');
        const videoForm = document.getElementById('videoForm');
        const videoUploadArea = document.getElementById('videoUploadArea');
        const videoFileInput = document.getElementById('videoFile');
        const videoPreview = document.getElementById('videoPreview');
        const videoPreviewElement = videoPreview.querySelector('video');
        const levelsList = document.getElementById('levelsList');
        const videosList = document.getElementById('videosList');
        const videoLevelSelect = document.getElementById('videoLevel');
        const toast = document.getElementById('toast');

        // Initialize the app
        async function init() {
            await renderLevelsList();
            await renderVideosList();
            await populateLevelSelect();
        }

        // Show toast notification
        function showToast(message, isError = false) {
            toast.textContent = message;
            toast.className = 'toast';
            if (isError) {
                toast.classList.add('error');
            }
            toast.classList.add('show');
            
            setTimeout(() => {
                toast.classList.remove('show');
            }, 3000);
        }

        // Populate level select in video form
        async function populateLevelSelect() {
            try {
                const response = await fetch(`${API_BASE}/levels`);
                const levels = await response.json();
                
                videoLevelSelect.innerHTML = '<option value="">Choose a level...</option>';
                levels.forEach(level => {
                    const option = document.createElement('option');
                    option.value = level.id;
                    option.textContent = `Level ${level.number}: ${level.title}`;
                    videoLevelSelect.appendChild(option);
                });
            } catch (error) {
                console.error('Error loading levels:', error);
                showToast('Error loading levels', true);
            }
        }

        // Render levels list
        async function renderLevelsList() {
            try {
                const response = await fetch(`${API_BASE}/levels`);
                const levels = await response.json();
                
                levelsList.innerHTML = '';
                
                if (levels.length === 0) {
                    levelsList.innerHTML = '<p style="text-align: center; color: #666;">No levels added yet.</p>';
                    return;
                }
                
                levels.sort((a, b) => a.number - b.number).forEach(async (level) => {
                    const levelItem = document.createElement('div');
                    levelItem.className = 'level-item';
                    
                    // Count videos for this level
                    const videosResponse = await fetch(`${API_BASE}/videos/level/${level.id}`);
                    const levelVideos = await videosResponse.json();
                    
                    levelItem.innerHTML = `
                        <div class="level-item-info">
                            <h4>${level.icon} Level ${level.number}: ${level.title}</h4>
                            <p>${level.description}</p>
                            <p><strong>Status:</strong> ${level.status} | <strong>Points:</strong> ${level.points} | <strong>Videos:</strong> ${levelVideos.length}</p>
                        </div>
                        <div class="level-actions">
                            <button class="action-btn edit-btn" onclick="editLevel(${level.id})">Edit</button>
                            <button class="action-btn delete-btn" onclick="deleteLevel(${level.id})">Delete</button>
                        </div>
                    `;
                    levelsList.appendChild(levelItem);
                });
            } catch (error) {
                console.error('Error loading levels:', error);
                levelsList.innerHTML = '<p style="text-align: center; color: #666;">Error loading levels.</p>';
            }
        }

        // Render videos list
        async function renderVideosList() {
            try {
                const response = await fetch(`${API_BASE}/videos`);
                const videos = await response.json();
                
                videosList.innerHTML = '';
                
                if (videos.length === 0) {
                    videosList.innerHTML = '<p style="text-align: center; color: #666;">No videos uploaded yet.</p>';
                    return;
                }
                
                videos.forEach(video => {
                    const videoItem = document.createElement('div');
                    videoItem.className = 'video-item';
                    videoItem.innerHTML = `
                        <div class="video-thumbnail">
                            üìπ
                        </div>
                        <h4>${video.title}</h4>
                        <p>Level ${video.level_number || 'N/A'}: ${video.level_title || 'Unknown'}</p>
                        <p style="font-size: 0.8rem; color: #666;">${video.filename}</p>
                        <div class="level-actions">
                            <button class="action-btn delete-btn" onclick="deleteVideo('${video.id}')">Delete</button>
                        </div>
                    `;
                    videosList.appendChild(videoItem);
                });
            } catch (error) {
                console.error('Error loading videos:', error);
                videosList.innerHTML = '<p style="text-align: center; color: #666;">Error loading videos.</p>';
            }
        }

        // Handle level form submission
        levelForm.addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const levelData = {
                number: parseInt(document.getElementById('levelNumber').value),
                title: document.getElementById('levelTitle').value,
                description: document.getElementById('levelDescription').value,
                icon: document.getElementById('levelIcon').value,
                status: document.getElementById('levelStatus').value,
                points: parseInt(document.getElementById('culturalPoints').value)
            };
            
            try {
                const response = await fetch(`${API_BASE}/levels`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(levelData)
                });
                
                if (!response.ok) {
                    throw new Error('Failed to create level');
                }
                
                await renderLevelsList();
                await populateLevelSelect();
                
                levelForm.reset();
                showToast('Level added successfully!');
            } catch (error) {
                console.error('Error creating level:', error);
                showToast('Error creating level', true);
            }
        });

        // Handle video upload area click
        videoUploadArea.addEventListener('click', function() {
            videoFileInput.click();
        });

        // Handle drag and drop for video upload
        videoUploadArea.addEventListener('dragover', function(e) {
            e.preventDefault();
            videoUploadArea.classList.add('dragover');
        });

        videoUploadArea.addEventListener('dragleave', function() {
            videoUploadArea.classList.remove('dragover');
        });

        videoUploadArea.addEventListener('drop', function(e) {
            e.preventDefault();
            videoUploadArea.classList.remove('dragover');
            
            if (e.dataTransfer.files.length) {
                videoFileInput.files = e.dataTransfer.files;
                handleVideoSelection();
            }
        });

        // Handle video file selection
        videoFileInput.addEventListener('change', handleVideoSelection);

        function handleVideoSelection() {
            if (videoFileInput.files.length > 0) {
                const file = videoFileInput.files[0];
                
                // Check file size (max 50MB)
                if (file.size > 50 * 1024 * 1024) {
                    showToast('File size must be less than 50MB', true);
                    return;
                }
                
                // Check file type
                if (!file.type.startsWith('video/')) {
                    showToast('Please select a video file', true);
                    return;
                }
                
                // Show preview
                const videoURL = URL.createObjectURL(file);
                videoPreviewElement.src = videoURL;
                videoPreview.style.display = 'block';
            }
        }

        // Helper function to convert file to base64
        function fileToBase64(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.readAsDataURL(file);
                reader.onload = () => resolve(reader.result);
                reader.onerror = error => reject(error);
            });
        }

        // Handle video form submission (using base64)
        videoForm.addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const levelId = parseInt(videoLevelSelect.value);
            const title = document.getElementById('videoTitle').value;
            const description = document.getElementById('videoDescription').value;
            
            if (!videoFileInput.files.length) {
                showToast('Please select a video file', true);
                return;
            }
            
            if (!levelId) {
                showToast('Please select a level', true);
                return;
            }
            
            const file = videoFileInput.files[0];
            
            try {
                // Show loading state
                const submitBtn = videoForm.querySelector('.submit-btn');
                const originalText = submitBtn.textContent;
                submitBtn.textContent = 'Uploading...';
                submitBtn.disabled = true;
                
                // Convert file to base64
                const videoData = await fileToBase64(file);
                
                const videoDataObj = {
                    level_id: levelId,
                    title: title,
                    description: description,
                    filename: file.name,
                    fileSize: file.size,
                    mimeType: file.type,
                    videoData: videoData
                };
                
                const response = await fetch(`${API_BASE}/videos`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(videoDataObj)
                });
                
                if (!response.ok) {
                    throw new Error('Failed to upload video');
                }
                
                await renderVideosList();
                await renderLevelsList();
                
                // Reset form
                videoForm.reset();
                videoPreview.style.display = 'none';
                
                showToast(`Video "${title}" uploaded successfully!`);
                
            } catch (error) {
                console.error('Error uploading video:', error);
                showToast('Error uploading video. Please try again.', true);
            } finally {
                // Restore button state
                const submitBtn = videoForm.querySelector('.submit-btn');
                submitBtn.textContent = 'Upload Video';
                submitBtn.disabled = false;
            }
        });

        // Delete level
        async function deleteLevel(levelId) {
            if (confirm('Are you sure you want to delete this level?')) {
                try {
                    const response = await fetch(`${API_BASE}/levels/${levelId}`, {
                        method: 'DELETE'
                    });
                    
                    if (!response.ok) {
                        throw new Error('Failed to delete level');
                    }
                    
                    await renderLevelsList();
                    await populateLevelSelect();
                    await renderVideosList();
                    
                    showToast('Level deleted successfully!');
                } catch (error) {
                    console.error('Error deleting level:', error);
                    showToast('Error deleting level', true);
                }
            }
        }

        // Delete video
        async function deleteVideo(videoId) {
            if (confirm('Are you sure you want to delete this video?')) {
                try {
                    const response = await fetch(`${API_BASE}/videos/${videoId}`, {
                        method: 'DELETE'
                    });
                    
                    if (!response.ok) {
                        throw new Error('Failed to delete video');
                    }
                    
                    await renderVideosList();
                    await renderLevelsList();
                    
                    showToast('Video deleted successfully!');
                } catch (error) {
                    console.error('Error deleting video:', error);
                    showToast('Error deleting video', true);
                }
            }
        }

        // Edit level (placeholder function)
        function editLevel(levelId) {
            // In a real application, you would implement edit functionality
            showToast('Edit functionality would be implemented here');
        }

        // Initialize the application
        init();
    </script>
</body>
</html>